<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>configuration &mdash; Configurator 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Configurator 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Configurator 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for configuration</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: configuration</span>
<span class="sd">     :synopsis: Implements the configurations model.</span>

<span class="sd">.. moduleauthor:: Mariano Montone &lt;marianomontone@gmail.com&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#import xml.etree.ElementTree as et</span>
<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> <span class="k">as</span> <span class="n">et</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">dependencies</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">email.utils</span>
<span class="kn">import</span> <span class="nn">urlparse</span>

<div class="viewcode-block" id="ConfigurationSchema"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema">[docs]</a><span class="k">class</span> <span class="nc">ConfigurationSchema</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Configuration schemas define the configurations structure. They have a name, a list of parents, and a list of sections with options definitions.</span>

<span class="sd">Configuration schemas can be composed by inheriting from multiple parents. Configuration sections from the parents appear in the child configuration schema. For instance, a full stack web framework configuration schema could inherit from a generic Web schema for web server configuration, and another Database schema for database connection configuration.</span>

<span class="sd">Configuration schemas have sections, each containing other sections and schema options. The schemas sections and options can be manipulated in the tree appearing on the left of the configuration schemas navigator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_configuration_schemas</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfigurationSchema.get_named"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.get_named">[docs]</a>    <span class="k">def</span> <span class="nf">get_named</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the configuration schema registered with name *name*&quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configuration_schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; schema not found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">schema</span>
    </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfigurationSchema.register_schema"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.register_schema">[docs]</a>    <span class="k">def</span> <span class="nf">register_schema</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a schema, globally. This is called automatically when a configuration schema is created.&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Registering schema &quot;</span> <span class="o">+</span> <span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_configuration_schemas</span><span class="p">[</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>
        </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfigurationSchema.unregister_schema"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.unregister_schema">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_schema</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregister a schema, globally.&quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configuration_schemas</span><span class="p">[</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        </div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfigurationSchema.configuration_schemas"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.configuration_schemas">[docs]</a>    <span class="k">def</span> <span class="nf">configuration_schemas</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of globally registered configuration schemas&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configuration_schemas</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>        
    </div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;parents&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">ConfigurationSchema</span><span class="o">.</span><span class="n">register_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                
<div class="viewcode-block" id="ConfigurationSchema.section"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.section">[docs]</a>    <span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add section *section* to schema&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="n">section</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchema.direct_sections"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.direct_sections">[docs]</a>    <span class="k">def</span> <span class="nf">direct_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return schema&#39;s direct sections (without looking at schema&#39;s parents sections)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchema.sections"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.sections">[docs]</a>    <span class="k">def</span> <span class="nf">sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return schema&#39;s sections recursively considering its parents&quot;&quot;&quot;</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_sections</span><span class="p">())</span>
        
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">():</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">sections</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">sections</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchema.move_section_backwards"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.move_section_backwards">[docs]</a>    <span class="k">def</span> <span class="nf">move_section_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move *section* backwards. For moving sections from UI&quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prev_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_section</span> 
            </div>
<div class="viewcode-block" id="ConfigurationSchema.move_section_forward"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.move_section_forward">[docs]</a>    <span class="k">def</span> <span class="nf">move_section_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move *section* forward (reorder). For moving sections from UI&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">next_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_section</span> 
    </div>
<div class="viewcode-block" id="ConfigurationSchema.get_section"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.get_section">[docs]</a>    <span class="k">def</span> <span class="nf">get_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get section with name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="ConfigurationSchema.remove_section"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.remove_section">[docs]</a>    <span class="k">def</span> <span class="nf">remove_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove *section* from the schema&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_sections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            </div>
<div class="viewcode-block" id="ConfigurationSchema.parents"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.parents">[docs]</a>    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the schema&#39;s parents list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">ConfigurationSchema</span><span class="o">.</span><span class="n">get_named</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchema.set_parents"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.set_parents">[docs]</a>    <span class="k">def</span> <span class="nf">set_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the schema&#39;s parents to *parents* list&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchema.add_parent"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.add_parent">[docs]</a>    <span class="k">def</span> <span class="nf">add_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds *parent* to the list of schema&#39;s parents&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        </div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The schema&#39;s name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@name.setter</span>
<div class="viewcode-block" id="ConfigurationSchema.name"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The schema&#39;s documentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span>
    
    <span class="nd">@documentation.setter</span>
<div class="viewcode-block" id="ConfigurationSchema.documentation"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchema.documentation">[docs]</a>    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ConfigurationSchema</span><span class="o">.</span><span class="n">unregister_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> 
    
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">option_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Section &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39; not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">section</span><span class="o">.</span><span class="n">option_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        </div>
<div class="viewcode-block" id="ConfigurationSchemaSection"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection">[docs]</a><span class="k">class</span> <span class="nc">ConfigurationSchemaSection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Configuration schema section&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Section name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@name.setter</span>
<div class="viewcode-block" id="ConfigurationSchemaSection.name"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
        </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.subsections"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.subsections">[docs]</a>    <span class="k">def</span> <span class="nf">subsections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the section&#39;s subsections&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span>
            </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.add_section"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.add_section">[docs]</a>    <span class="k">def</span> <span class="nf">add_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds section *section* as a subsection&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="n">section</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.remove_section"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.remove_section">[docs]</a>    <span class="k">def</span> <span class="nf">remove_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the subsection *section*&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.options"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.options">[docs]</a>    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the section&#39;s options list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.add_option"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.add_option">[docs]</a>    <span class="k">def</span> <span class="nf">add_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds option *option* to the section&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        <span class="n">option</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.remove_option"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.remove_option">[docs]</a>    <span class="k">def</span> <span class="nf">remove_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes option *option* from the section&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>        
        </div>
<div class="viewcode-block" id="ConfigurationSchemaSection.get_option"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.get_option">[docs]</a>    <span class="k">def</span> <span class="nf">get_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets section option with name *name* from the section.</span>
<span class="sd">        If it is not found, None is return&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">opt</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        </div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The section&#39;s documentation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span>
    
    <span class="nd">@documentation.setter</span>
<div class="viewcode-block" id="ConfigurationSchemaSection.documentation"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.documentation">[docs]</a>    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The section&#39;s parent. It can be the configuration schema if it is a top-level section, of the parent section if it is a subsection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
    
    <span class="nd">@parent.setter</span>
<div class="viewcode-block" id="ConfigurationSchemaSection.parent"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    </div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dependency_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The section&#39;s dependency expression&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span>
    
    <span class="nd">@dependency_expression.setter</span>
<div class="viewcode-block" id="ConfigurationSchemaSection.dependency_expression"><a class="viewcode-back" href="../index.html#configuration.ConfigurationSchemaSection.dependency_expression">[docs]</a>    <span class="k">def</span> <span class="nf">dependency_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span> <span class="o">=</span> <span class="n">value</span>
    </div>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">remove_section</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
    
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">ConfigurationSchema</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">move_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span><span class="o">.</span><span class="n">move_section_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span><span class="o">.</span><span class="n">move_section_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">move_option_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prev_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_option</span> 
            
    <span class="k">def</span> <span class="nf">move_option_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">next_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_option</span> 
    
    <span class="k">def</span> <span class="nf">option_in_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># There are subsections in path</span>
            <span class="n">subsection</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">None</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">subsection</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Subsection not found &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">subsection</span><span class="o">.</span><span class="n">option_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Find the option</span>
            <span class="n">option</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">None</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Option not found &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">option</span>
        
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="c"># Validate the section using config</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="n">option_value</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">option_value</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">option_is_enabled</span><span class="p">(</span><span class="n">option</span><span class="p">)</span> <span class="ow">and</span> <span class="n">option</span><span class="o">.</span><span class="n">is_required</span> <span class="ow">and</span> <span class="n">option</span><span class="o">.</span><span class="n">default_value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">option_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">errors</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;option&#39;</span><span class="p">:</span><span class="n">option</span><span class="p">,</span> <span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="n">option</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; is required&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">option_value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">errors</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;option&#39;</span><span class="p">:</span><span class="n">option</span><span class="p">,</span> <span class="s">&#39;message&#39;</span> <span class="p">:</span> <span class="n">option</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">error</span><span class="p">}</span>             
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">errors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>               
</div>
<span class="k">class</span> <span class="nc">ConfigurationSchemaOption</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">option_type</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">option_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_section</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_required</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;required&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;default_value&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span>
    
    <span class="nd">@option_type.setter</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span>
    
    <span class="nd">@documentation.setter</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_section</span>
    
    <span class="nd">@section.setter</span>
    <span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_section</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">remove_option</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_required</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_required</span>
    
    <span class="nd">@is_required.setter</span>
    <span class="k">def</span> <span class="nf">is_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_required</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span>
    
    <span class="nd">@default_value.setter</span>
    <span class="k">def</span> <span class="nf">default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dependency_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span>
    
    <span class="nd">@dependency_expression.setter</span>
    <span class="k">def</span> <span class="nf">dependency_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependency_expression</span> <span class="o">=</span> <span class="n">value</span>
    
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
    
    <span class="k">def</span> <span class="nf">path_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">move_option_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">move_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">move_option_backwards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_type</span><span class="o">.</span><span class="n">unparse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_type</span><span class="o">.</span><span class="n">display_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_type</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">OptionType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">option_name</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_named</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">option_type</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">option_type</span> <span class="k">for</span> <span class="n">option_type</span> <span class="ow">in</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span> <span class="k">if</span> <span class="n">option_type</span><span class="o">.</span><span class="n">option_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">option_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;No option type named &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">option_type</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">option_types</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">all_subclasses</span><span class="p">(</span><span class="n">OptionType</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">option_name</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
   
<span class="k">class</span> <span class="nc">StringOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;String&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_StringOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">NumberOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Number&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_NumberOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Should be a number&quot;</span>        
    
<span class="k">class</span> <span class="nc">BooleanOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Boolean&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_BooleanOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;True&#39;</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Should be a boolean&quot;</span>
   
<span class="k">class</span> <span class="nc">EmailOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Email&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_EmailOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parseaddr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; is an invalid email&quot;</span>
    
<span class="k">class</span> <span class="nc">URIOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;URI&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_URIOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c">#print &quot;URI validation result: &quot; + str(uri)</span>
    
<span class="k">class</span> <span class="nc">FilenameOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Filename&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_FilenameOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">DirectoryOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Directory&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_DirectoryOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">ColorOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Color&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_ColorOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">TimezoneOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Timezone&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_TimezoneOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">CountryOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Country&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_CountryOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">LanguageOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Language&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_LanguageOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">CurrencyOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Currency&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_CurrencyOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">DateOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Date&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_DateOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>  
    
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>         
    
<span class="k">class</span> <span class="nc">TimeOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Time&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_TimeOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">DatetimeOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Datetime&quot;</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_DatetimeOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">tuple</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">),</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;%H:%M:%S&quot;</span><span class="p">))</span>
     
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">datestring</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>
        <span class="n">timestring</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;(&#39;&quot;</span> <span class="o">+</span> <span class="n">datestring</span> <span class="o">+</span> <span class="s">&quot;&#39;,&#39;&quot;</span> <span class="o">+</span> <span class="n">timestring</span> <span class="o">+</span> <span class="s">&quot;&#39;)&quot;</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">datestring</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>
        <span class="n">timestring</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datestring</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">timestring</span>                       
    
<span class="k">class</span> <span class="nc">ChoiceOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Choice&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="n">options</span>
        
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
    
    <span class="k">def</span> <span class="nf">add_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Adding option &quot;</span> <span class="o">+</span> <span class="n">option</span> <span class="o">+</span> <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_ChoiceOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s"> is not a valid choice (&#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
    
<span class="k">class</span> <span class="nc">ListOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;List&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="n">options</span>
        
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
    
    <span class="k">def</span> <span class="nf">add_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_ListOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">()))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; are not a valid list members (&#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        
<span class="k">class</span> <span class="nc">MaybeOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Maybe&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OptionType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">option_type</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> 
    
    <span class="nd">@option_type.setter</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_MaybeOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">OneOfOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;One of&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">OptionType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
               
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">option_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_types</span> 
    
    <span class="nd">@option_types.setter</span>
    <span class="k">def</span> <span class="nf">option_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_types</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>       
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_OneOfOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">ManyOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;Many&quot;</span>   
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OptionType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">option_type</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> 
    
    <span class="nd">@option_type.setter</span>
    <span class="k">def</span> <span class="nf">option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_ManyOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option_type</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
    
<span class="k">class</span> <span class="nc">CustomOptionType</span><span class="p">(</span><span class="n">OptionType</span><span class="p">):</span>
    
    <span class="n">_custom_option_types</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_named</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">option_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_custom_option_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option_type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; custom option type not found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">option_type</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">register_custom_option_type</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Registering custom option type &quot;</span> <span class="o">+</span> <span class="n">option_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_custom_option_types</span><span class="p">[</span><span class="n">option_type</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_type</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">unregister_custom_option_type</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">cls</span><span class="o">.</span><span class="n">_custom_option_types</span><span class="p">[</span><span class="n">option_type</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">custom_option_types</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_custom_option_types</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  
          
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OptionType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="n">CustomOptionType</span><span class="o">.</span><span class="n">register_custom_option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> 
    
    <span class="nd">@attributes.setter</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">add_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> 
    
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">visitor</span><span class="o">.</span><span class="n">visit_CustomOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
      
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="n">_configurations</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_named</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configurations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; configuration not found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">register_config</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Registering config &quot;</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_configurations</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">unregister_config</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configurations</span><span class="p">[</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">configurations</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_configurations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>    
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="n">Configuration</span><span class="o">.</span><span class="n">register_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">ConfigurationSchema</span><span class="o">.</span><span class="n">get_named</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">)</span>
    
    <span class="nd">@schema.setter</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">get_named</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">)</span>
    
    <span class="nd">@parent.setter</span>
    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span>
            
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span>
    
    <span class="nd">@documentation.setter</span>
    <span class="k">def</span> <span class="nf">documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_documentation</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">set_option_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_option</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; configuration: Setting &#39;</span> <span class="o">+</span> <span class="n">schema_option</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">option</span> <span class="o">=</span> <span class="n">ConfigurationOption</span><span class="p">(</span><span class="n">schema_option</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">schema_option</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
        
    <span class="k">def</span> <span class="nf">unset_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_option</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_option</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">schema_option</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">option_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_option</span><span class="p">):</span>
        <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_option</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="p">:</span>
            <span class="c"># Return a tuple, the option value and its origin (the configuration that has its value)</span>
            <span class="k">return</span> <span class="n">option</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">option_value</span><span class="p">(</span><span class="n">schema_option</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
            
    <span class="k">def</span> <span class="nf">option_is_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_option</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">schema_option</span><span class="o">.</span><span class="n">dependency_expression</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Option enabled &quot;</span> <span class="o">+</span> <span class="n">schema_option</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">schema_option</span><span class="o">.</span><span class="n">dependency_expression</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> 
            <span class="k">return</span> <span class="n">schema_option</span><span class="o">.</span><span class="n">dependency_expression</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
            <span class="n">section_errors</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">section_errors</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">section_errors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Configuration &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; is not valid: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">errors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Configuration &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; is valid&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>        
        
<span class="k">class</span> <span class="nc">ConfigurationOption</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>
    
    <span class="nd">@schema.setter</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">name</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
    
    <span class="nd">@value.setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">path_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    
    <span class="k">def</span> <span class="nf">unparse_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">unparse_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">display_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Serializer</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">XMLSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ConfigurationsXMLSerializer</span><span class="p">(</span><span class="n">XMLSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&#39;configurations&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">config_element</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span> <span class="s">&#39;configuration&#39;</span><span class="p">)</span>
        <span class="n">config_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">name</span>
                
        <span class="n">schema</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">config_element</span><span class="p">,</span> <span class="s">&#39;schema&#39;</span><span class="p">)</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">config_element</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
        
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="n">option_elem</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">config_element</span><span class="p">,</span> <span class="s">&#39;option&#39;</span><span class="p">)</span>
            <span class="n">option_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">path_string</span><span class="p">()</span>
            <span class="n">option_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_option_value</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">serialize_option_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">option</span><span class="o">.</span><span class="n">unparse_value</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
       
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipient</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">ConfigurationsXMLUnserializer</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span> <span class="o">=</span> <span class="p">[]</span>
                   
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unserialize</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span>
                
    <span class="k">def</span> <span class="nf">unserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span>
                       
            <span class="n">schema_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;schema&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">ConfigurationSchema</span><span class="o">.</span><span class="n">get_named</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
            
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">documentation</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>
            
            <span class="n">parent</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                       
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;option&#39;</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">option_in_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">option_type</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Unserialize: Setting &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; value: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">set_option_value</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
                  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configs</span>          

<span class="k">class</span> <span class="nc">ConfigurationSchemasXMLSerializer</span><span class="p">(</span><span class="n">XMLSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span>  <span class="n">et</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;schemas&quot;</span><span class="p">)</span>
          
    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="n">schema_element</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">,</span> <span class="s">&quot;schema&quot;</span><span class="p">)</span>
        <span class="n">schema_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">schema_element</span><span class="p">,</span> <span class="s">&#39;documentation&#39;</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">documentation</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">parents</span><span class="p">():</span>
            <span class="n">parent_element</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">schema_element</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">)</span>
            <span class="n">parent_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span>
            
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">direct_sections</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serialize_section</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">schema_element</span><span class="p">)</span>
                        
    <span class="k">def</span> <span class="nf">serialize_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">sections</span><span class="p">):</span>
        <span class="n">section_element</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="s">&#39;section&#39;</span><span class="p">)</span>
        <span class="n">section_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">name</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">section_element</span><span class="p">,</span> <span class="s">&#39;documentation&#39;</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">documentation</span>
               
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serialize_option</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">section_element</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">subsection</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">subsections</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serialize_section</span><span class="p">(</span><span class="n">subsection</span><span class="p">,</span> <span class="n">section_element</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">serialize_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">option_elem</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s">&#39;option&#39;</span><span class="p">)</span>
        <span class="n">option_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">name</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">option_elem</span><span class="p">,</span> <span class="s">&#39;documentation&#39;</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">documentation</span>
        <span class="n">option_type</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">option_elem</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_option_type</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">option_type</span><span class="p">,</span> <span class="n">option_type</span><span class="p">)</span>
        <span class="n">required</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">option_elem</span><span class="p">,</span> <span class="s">&#39;required&#39;</span><span class="p">)</span>
        <span class="n">required</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;True&#39;</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">is_required</span> <span class="k">else</span> <span class="s">&#39;False&#39;</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">option_elem</span><span class="p">,</span> <span class="s">&#39;default&#39;</span><span class="p">)</span>
            <span class="n">default_value</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">option_type</span><span class="o">.</span><span class="n">unparse_value</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">dependency_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dependency_expression</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">option_elem</span><span class="p">,</span> <span class="s">&#39;dependency&#39;</span><span class="p">)</span>
            <span class="n">dependency_expression</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">dependency_expression</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">serialize_option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_type</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_elem</span> <span class="o">=</span> <span class="n">element</span>
        
        <span class="n">visitor_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;serialize&quot;</span> <span class="o">+</span> <span class="n">option_type</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;OptionType&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">visitor_method</span><span class="p">):</span>
            <span class="n">visitor_method</span><span class="p">(</span><span class="n">option_type</span><span class="p">)</span>     
    
    <span class="k">def</span> <span class="nf">serializeChoiceOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">option_type</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_option_elem</span><span class="p">,</span> <span class="s">&#39;option&#39;</span><span class="p">)</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
            
    <span class="k">def</span> <span class="nf">serializeListOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">option_type</span><span class="o">.</span><span class="n">options</span><span class="p">():</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_option_elem</span><span class="p">,</span> <span class="s">&#39;option&#39;</span><span class="p">)</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
            
    <span class="k">def</span> <span class="nf">serializeManyOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="n">many_type</span> <span class="o">=</span> <span class="n">option_type</span><span class="o">.</span><span class="n">option_type</span>
        <span class="n">many_type_elem</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_option_elem</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="n">many_type_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">many_type</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_option_type</span><span class="p">(</span><span class="n">option_type</span><span class="o">.</span><span class="n">option_type</span><span class="p">,</span> <span class="n">many_type_elem</span><span class="p">)</span> 
            
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipient</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">ConfigurationSchemasXMLUnserializer</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">cfg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="bp">None</span>
                
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unserialize</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span>
                
    <span class="k">def</span> <span class="nf">unserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span>
            
            <span class="n">sch</span> <span class="o">=</span> <span class="n">ConfigurationSchema</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">documentation</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;parent&#39;</span><span class="p">):</span>
                <span class="n">sch</span><span class="o">.</span><span class="n">add_parent</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;section&#39;</span><span class="p">):</span>
                <span class="n">sch</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unserialize_section</span><span class="p">(</span><span class="n">section</span><span class="p">))</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sch</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span>            
            
    <span class="k">def</span> <span class="nf">unserialize_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section_elem</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">section_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">section_elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Unserializing section &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">ConfigurationSchemaSection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">documentation</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">section_elem</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;option&#39;</span><span class="p">):</span>
            <span class="n">section</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unserialize_option</span><span class="p">(</span><span class="n">option</span><span class="p">))</span>
            
        <span class="k">for</span> <span class="n">subsection</span> <span class="ow">in</span> <span class="n">section_elem</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;section&#39;</span><span class="p">):</span>
            <span class="n">section</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unserialize_section</span><span class="p">(</span><span class="n">subsection</span><span class="p">))</span>
            
        <span class="k">return</span> <span class="n">section</span>
    
    <span class="k">def</span> <span class="nf">unserialize_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_elem</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;documentation&#39;</span><span class="p">)</span>
        <span class="n">is_required</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;required&#39;</span><span class="p">)</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
        <span class="n">option_type_elem</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
        <span class="n">option_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unserialize_option_type</span><span class="p">(</span><span class="n">option_type_elem</span><span class="p">)</span>
        <span class="n">dependency_expression</span> <span class="o">=</span> <span class="n">option_elem</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s">&#39;dependency&#39;</span><span class="p">)</span>
                
        <span class="n">option</span> <span class="o">=</span> <span class="n">ConfigurationSchemaOption</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">option_type</span><span class="p">,</span> <span class="n">documentation</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>
        
        <span class="n">option</span><span class="o">.</span><span class="n">is_required</span> <span class="o">=</span> <span class="n">is_required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">eval</span><span class="p">(</span><span class="n">is_required</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">option</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">option_type</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">default_value</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">dependency_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">option</span><span class="o">.</span><span class="n">dependency_expression</span> <span class="o">=</span> <span class="n">DependencyExpressionParser</span><span class="o">.</span><span class="n">parse_expression</span><span class="p">(</span><span class="n">dependency_expression</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">option</span>
        
    <span class="k">def</span> <span class="nf">unserialize_option_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type_elem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_type_elem</span> <span class="o">=</span> <span class="n">option_type_elem</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="n">option_type_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">option_type_class</span> <span class="o">=</span> <span class="n">OptionType</span><span class="o">.</span><span class="n">get_named</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        
        <span class="n">option_type</span> <span class="o">=</span> <span class="n">option_type_class</span><span class="p">()</span>
        
        <span class="n">visitor_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;unserialize&quot;</span> <span class="o">+</span> <span class="n">option_type</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;OptionType&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">visitor_method</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">visitor_method</span><span class="p">(</span><span class="n">option_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">option_type</span>        
       
    <span class="k">def</span> <span class="nf">unserializeChoiceOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type_elem</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;option&#39;</span><span class="p">):</span>
            <span class="n">option_type</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">option_type</span>
    
    <span class="k">def</span> <span class="nf">unserializeListOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type_elem</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;option&#39;</span><span class="p">):</span>
            <span class="n">option_type</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">option_type</span>
    
    <span class="k">def</span> <span class="nf">unserializeManyOptionType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_type</span><span class="p">):</span>
        <span class="n">many_type_elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_type_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
        
        <span class="n">many_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unserialize_option_type</span><span class="p">(</span><span class="n">many_type_elem</span><span class="p">)</span>
        <span class="n">option_type</span><span class="o">.</span><span class="n">option_type</span> <span class="o">=</span> <span class="n">many_type</span>
        <span class="k">return</span> <span class="n">option_type</span>   
    
<span class="k">class</span> <span class="nc">YAMLSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c"># Dependency expressions</span>
<span class="k">class</span> <span class="nc">DependencyExpression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">BooleanConnector</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arg1</span> <span class="o">=</span> <span class="n">arg1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arg2</span> <span class="o">=</span> <span class="n">arg2</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arg1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg1</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arg2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg2</span>
        

<span class="k">class</span> <span class="nc">DEAnd</span><span class="p">(</span><span class="n">BooleanConnector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; AND &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
              
<span class="k">class</span> <span class="nc">DEOr</span><span class="p">(</span><span class="n">BooleanConnector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; OR &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DEXor</span><span class="p">(</span><span class="n">BooleanConnector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; XOR &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>    

<span class="k">class</span> <span class="nc">BooleanOperation</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arg1</span> <span class="o">=</span> <span class="n">arg1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arg2</span> <span class="o">=</span> <span class="n">arg2</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arg1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg1</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arg2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arg2</span>
        

<span class="k">class</span> <span class="nc">DEEqual</span><span class="p">(</span><span class="n">BooleanOperation</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>    


<span class="k">class</span> <span class="nc">DEGreaterThan</span><span class="p">(</span><span class="n">BooleanOperation</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>    

<span class="k">class</span> <span class="nc">DELowerThan</span><span class="p">(</span><span class="n">BooleanOperation</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">DEDifferentFrom</span><span class="p">(</span><span class="n">BooleanOperation</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">DEOptionPath</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>  
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">option</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">option_in_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">option_value</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
    
<span class="k">class</span> <span class="nc">DEString</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
    
<span class="k">class</span> <span class="nc">DEBoolean</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
    
<span class="k">class</span> <span class="nc">DENumber</span><span class="p">(</span><span class="n">DependencyExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">DependencyExpression</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>              
    
<span class="k">class</span> <span class="nc">DependencyExpressionParser</span><span class="p">():</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_expression</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">dependenciesParser</span><span class="p">(</span><span class="n">parseinfo</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">whitespace</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> 
                           <span class="n">rule_name</span><span class="o">=</span><span class="s">&#39;boolexp&#39;</span><span class="p">,</span> 
                           <span class="n">semantics</span><span class="o">=</span><span class="n">DependencyExpressionParser</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ast</span>
    
    <span class="k">def</span> <span class="nf">bool_literal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ast</span> <span class="o">==</span> <span class="s">&#39;True&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEBoolean</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ast</span> <span class="o">==</span> <span class="s">&#39;False&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEBoolean</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error parsing literal boolean &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ast</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">option_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">path</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ast</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">DEOptionPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEOptionPath</span><span class="p">([</span><span class="n">ast</span><span class="p">])</span>
        
    <span class="k">def</span> <span class="nf">identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">x</span>
                
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">literal_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">DEString</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">boolexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="c">#print &quot;Boolexp: &quot; + str(ast)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">connector</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">exp</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">connector</span> <span class="o">==</span> <span class="s">&#39;AND&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEAnd</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">connector</span> <span class="o">==</span> <span class="s">&#39;OR&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEOr</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">connector</span> <span class="o">==</span> <span class="s">&#39;XOR&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEXor</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error parsing boolean expression &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ast</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span>
        
    <span class="k">def</span> <span class="nf">boolterm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="c">#print &quot;Boolterm: &quot; + str(ast)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">option_path</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;=&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEEqual</span><span class="p">(</span><span class="n">option_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEGreaterThan</span><span class="p">(</span><span class="n">option_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DELowerThan</span><span class="p">(</span><span class="n">option_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;&lt;&gt;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DEDifferentFrom</span><span class="p">(</span><span class="n">option_path</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span>
        
    <span class="k">def</span> <span class="nf">number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">):</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ast</span><span class="p">:</span>
            <span class="nb">str</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">DENumber</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Configurator 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Mariano Montone.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>